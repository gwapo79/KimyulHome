generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                  String               @id @default(uuid())
  email               String               @unique
  password            String?
  name                String?
  phone               String?
  provider            String               @default("local")
  kakaoId             String?              @unique
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  billingHistory      BillingHistory[]
  events              CalendarEvent[]
  cases               Case[]
  chatRooms           ChatRoom[]
  documents           Document[]
  notificationSetting NotificationSetting?
  notifications       Notification[]
  address             String?
  avatarUrl           String?
}

model NotificationSetting {
  id               String   @id @default(uuid())
  userId           String   @unique
  caseUpdateEmail  Boolean  @default(true)
  caseUpdateSms    Boolean  @default(true)
  scheduleReminder Boolean  @default(true)
  marketingAgree   Boolean  @default(false)
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Notification {
  id          String   @id @default(uuid())
  userId      String
  title       String
  message     String
  type        String   @default("info") // info, success, warning, error
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model BillingHistory {
  id            String    @id @default(uuid())
  userId        String
  itemName      String
  amount        Int
  status        String
  paymentMethod String
  paidAt        DateTime?
  receiptUrl    String?
  createdAt     DateTime  @default(now())
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Case {
  id                  String     @id @default(uuid())
  userId              String
  title               String
  description         String?
  status              String
  statusColor         String
  caseNumber          String?
  courtName           String?
  judgeInfo           String?
  opponentName        String?
  lawyerInCharge      String?
  claimAmount         BigInt?
  contractDate        DateTime?
  caseDescriptionLong String?
  timelineJson        Json?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  user                User       @relation(fields: [userId], references: [id])
  documents           Document[]
}

model Document {
  id        String   @id @default(uuid())
  caseId    String?
  fileName  String
  fileSize  String
  fileType  String
  url       String
  createdAt DateTime @default(now())
  category  String?
  userId    String
  case      Case?    @relation(fields: [caseId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ... (User Model etc above)

model TeamMember {
  id          String   @id @default(uuid())
  name        String
  role        String   // 변호사, 법무사 등
  position    String   // 대표변호사, 소속법무사 등
  specialty   String?  // 전문분야
  imageUrl    String?
  email       String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  successCases SuccessCase[]
  blogPosts    BlogPost[]
  reviews      Review[]
  faqs         FAQ[]
  chatRooms    ChatRoom[]
}

model SuccessCase {
  id             String   @id @default(uuid())
  title          String
  category       String
  summary        String?
  client         String?
  caseType       String?
  amount         String?
  period         String?
  lawyer         String? // Legacy String
  result         String?
  background     String?
  strategy       String?
  outcomes       String?
  imageUrl       String?
  detailImageUrl String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  lawyerComment  String?
  lawyerImageUrl String?
  
  lawyerId       String?
  teamMember     TeamMember? @relation(fields: [lawyerId], references: [id])
}

model Review {
  id             String   @id @default(uuid())
  author         String
  rating         Int
  content        String
  category       String?
  createdAt      DateTime @default(now())
  authorImageUrl String?
  date           String?
  role           String? // User role (e.g. 'Business Owner')

  counselorId    String?
  counselor      TeamMember? @relation(fields: [counselorId], references: [id])
}

model FAQ {
  id        String   @id @default(uuid())
  question  String
  answer    String
  category  String
  order     Int      @default(0)
  createdAt DateTime @default(now())

  authorId    String?
  author      TeamMember? @relation(fields: [authorId], references: [id])
}

model BlogPost {
  id           String   @id @default(uuid())
  title        String
  content      String
  excerpt      String
  category     String
  thumbnailUrl String
  author       String // Legacy
  viewCount    Int      @default(0)
  createdAt    DateTime @default(now())

  authorId     String?
  authorMember TeamMember? @relation(fields: [authorId], references: [id])
}

model Consultation {
  id        String   @id @default(uuid())
  name      String
  phone     String
  category  String
  content   String
  status    String   @default("접수")
  createdAt DateTime @default(now())
}

model CalendarEvent {
  id          String   @id @default(uuid())
  userId      String
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  category    String
  color       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ChatRoom {
  id        String        @id @default(uuid())
  userId    String
  lawyerId  String?
  title     String
  status    String        @default("active")
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  messages  ChatMessage[]
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  lawyer    TeamMember?   @relation(fields: [lawyerId], references: [id])
}

model ChatMessage {
  id        String   @id @default(uuid())
  roomId    String
  senderId  String
  content   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  room      ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
}
