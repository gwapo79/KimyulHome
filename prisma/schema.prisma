generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL")
}

enum Role {
  SUPER_ADMIN
  CEO
  LAWYER
  STAFF
  DEV
  USER
}

model SiteConfiguration {
  id             String   @id @default(uuid())
  companyName    String   @default("서초지율 합동법률사무소")
  representative String   @default("김지율")
  address        String   @default("서울시 서초구 서초중앙로24길 3 4층")
  phone          String   @default("02-6080-3377")
  email          String   @default("sjlaw14@naver.com")
  businessNumber String   @default("123-45-67890")
  mainTitle      String   @default("서초지율 - 법률과 금융의 통합 솔루션")
  description    String   @default("부동산 분쟁부터 채무 조정까지, 서초지율이 함께합니다.")
  updatedAt      DateTime @updatedAt
}

model Banner {
  id        String   @id @default(uuid())
  imageUrl  String
  title     String
  subtitle  String?
  linkUrl   String?
  isActive  Boolean  @default(true)
  position  String   @default("MAIN_HERO")
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id                  String               @id @default(uuid())
  email               String               @unique
  password            String?
  name                String?
  phone               String?
  role                Role                 @default(USER)
  provider            String               @default("local")
  kakaoId             String?              @unique
  status              String               @default("ACTIVE") // ACTIVE, BLOCKED, WITHDRAWN
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  
  billingHistory      BillingHistory[]
  events              CalendarEvent[]
  cases               Case[]
  chatRooms           ChatRoom[]
  documents           Document[]
  notificationSetting NotificationSetting?
  notifications       Notification[]
  
  address             String?
  avatarUrl           String?
  
  consultations       Consultation[]
  activities          UserActivity[]
}

model NotificationSetting {
  id               String   @id @default(uuid())
  userId           String   @unique
  caseUpdateEmail  Boolean  @default(true)
  caseUpdateSms    Boolean  @default(true)
  scheduleReminder Boolean  @default(true)
  marketingAgree   Boolean  @default(false)
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Notification {
  id          String   @id @default(uuid())
  userId      String
  title       String
  message     String
  type        String   @default("info")
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model BillingHistory {
  id            String    @id @default(uuid())
  userId        String
  itemName      String
  amount        Int
  status        String
  paymentMethod String
  paidAt        DateTime?
  receiptUrl    String?
  createdAt     DateTime  @default(now())
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Case {
  id                  String     @id @default(uuid())
  userId              String
  title               String
  description         String?
  status              String
  statusColor         String
  caseNumber          String?
  courtName           String?
  judgeInfo           String?
  opponentName        String?
  
  lawyerInCharge      String?    // Legacy
  lawyerId            String?
  lawyer              TeamMember? @relation(fields: [lawyerId], references: [id])
  
  claimAmount         BigInt?
  contractDate        DateTime?
  caseDescriptionLong String?
  timelineJson        Json?
  
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  
  user                User       @relation(fields: [userId], references: [id])
  documents           Document[]
  
  timelines           CaseTimeline[]
  payments            CasePayment[]
  events              CaseEvent[]
}

model CaseTimeline {
  id          String   @id @default(uuid())
  caseId      String
  case        Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)
  status      String
  date        DateTime
  description String?
  createdAt   DateTime @default(now())
}

model CasePayment {
  id          String   @id @default(uuid())
  caseId      String
  case        Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)
  title       String
  amount      Int
  dueDate     DateTime?
  status      String   @default("PENDING")
  paidAt      DateTime?
  createdAt   DateTime @default(now())
}

model CaseEvent {
  id          String   @id @default(uuid())
  caseId      String
  case        Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)
  title       String
  date        DateTime
  location    String?
  memo        String?
  type        String
  createdAt   DateTime @default(now())
}

model Document {
  id        String   @id @default(uuid())
  caseId    String?
  fileName  String
  fileSize  String
  fileType  String
  url       String
  createdAt DateTime @default(now())
  category  String?
  userId    String
  case      Case?    @relation(fields: [caseId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TeamMember {
  id          String   @id @default(uuid())
  name        String
  role        String
  position    String
  specialty   String?
  imageUrl    String?
  email       String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  successCases    SuccessCase[]
  blogPosts       BlogPost[]
  reviews         Review[]
  faqs            FAQ[]
  chatRooms       ChatRoom[]
  assignedCases   Case[]
  assignedConsultations Consultation[]
}

model SuccessCase {
  id             String   @id @default(uuid())
  title          String
  category       String
  summary        String?
  client         String?
  caseType       String?
  amount         String?
  period         String?
  lawyer         String?
  result         String?
  background     String?
  strategy       String?
  outcomes       String?
  imageUrl       String?
  detailImageUrl String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  lawyerComment  String?
  lawyerImageUrl String?
  
  lawyerId       String?
  teamMember     TeamMember? @relation(fields: [lawyerId], references: [id])

  // New Fields for Full Admin Control
  subTitle       String?
  content        String?   // WYSIWYG Content
  seoTitle       String?
  seoDescription String?
  seoOgImage     String?
  kpiInfo        Json?     // Dynamic KPI Array [{label, value, description}]
  thumbnailUrl   String?   // Representative Thumbnail for Lists
}

model Review {
  id             String   @id @default(uuid())
  author         String
  rating         Int
  content        String
  category       String?
  createdAt      DateTime @default(now())
  authorImageUrl String?
  date           String?
  role           String? 
  isVisible      Boolean  @default(true)
  isBest         Boolean  @default(false)
  
  counselorId    String?
  counselor      TeamMember? @relation(fields: [counselorId], references: [id])
}

model FAQ {
  id        String   @id @default(uuid())
  question  String
  answer    String
  category  String
  order     Int      @default(0)
  createdAt DateTime @default(now())

  authorId    String?
  author      TeamMember? @relation(fields: [authorId], references: [id])
}

model BlogPost {
  id           String   @id @default(uuid())
  title        String
  content      String
  excerpt      String
  category     String
  thumbnailUrl String
  author       String
  viewCount    Int      @default(0)
  status       String   @default("PUBLISHED")
  createdAt    DateTime @default(now())

  authorId     String?
  authorMember TeamMember? @relation(fields: [authorId], references: [id])
}

model Consultation {
  id          String   @id @default(uuid())
  name        String
  phone       String
  category    String
  content     String
  status      String   @default("접수")
  memo        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt @default(now())

  assigneeId  String?
  assignee    TeamMember? @relation(fields: [assigneeId], references: [id])
  
  userId      String?
  user        User?       @relation(fields: [userId], references: [id])
}

model UserActivity {
  id         String   @id @default(uuid())
  userId     String
  type       String   // LOGIN, VIEW_PAGE, CLICK_ACTION, etc.
  details    String?  // JSON string or description
  ipAddress  String?
  device     String?  // OS / Browser info
  path       String?  // URL Path or Screen Name
  createdAt  DateTime @default(now())
  
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CalendarEvent {
  id          String   @id @default(uuid())
  userId      String
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  category    String
  color       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ChatRoom {
  id        String        @id @default(uuid())
  userId    String
  lawyerId  String?
  title     String
  status    String        @default("active")
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  messages  ChatMessage[]
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  lawyer    TeamMember?   @relation(fields: [lawyerId], references: [id])
}


model ChatMessage {
  id        String   @id @default(uuid())
  roomId    String
  senderId  String
  content   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  room      ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model Contact {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String
  content   String
  status    String   @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, REJECTED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
